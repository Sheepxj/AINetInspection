(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed22e186"],{"2ff2":function(t,a,e){},3808:function(t,a,e){"use strict";e("2ff2")},b562:function(t,a,e){"use strict";e.d(a,"a",(function(){return s})),e.d(a,"c",(function(){return n})),e.d(a,"b",(function(){return r}));var i=e("ccea");function s(){return Object(i["a"])({url:"/boards/location",method:"get"})}function n(t){return Object(i["a"])({url:"/warningTable/selectwarning",method:"post",data:t})}function r(t){return Object(i["a"])({url:"/warningTable/selectbytaskid",method:"get",params:t})}},f82c:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"app"},[e("van-nav-bar",{attrs:{title:"AI视频卫士"}}),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"mask"},[e("div",{staticClass:"monitor-container"},[e("div",{staticClass:"action vertical"},[e("div",{staticClass:"filter"},[e("el-cascader",{attrs:{options:t.locationList,placeholder:"请选择监控画面",size:"small"},on:{change:t.handleLocationChange},model:{value:t.location,callback:function(a){t.location=a},expression:"location"}})],1)]),e("div",{staticClass:"content"},[e("live-player",{attrs:{containerId:"video-live",streamId:t.streamId,streamUrl:t.streamUrl}})],1)]),e("div",{staticClass:"warning-container"},[t._m(0),e("div",{staticClass:"content"},[e("div",{staticClass:"event-list"},[e("van-list",{attrs:{finished:t.finished,error:t.error,"error-text":"请求失败，点击重新加载","finished-text":"没有更多了"},on:{"update:error":function(a){t.error=a},load:t.onLoad},model:{value:t.loadingMore,callback:function(a){t.loadingMore=a},expression:"loadingMore"}},t._l(t.alarmList,(function(a,i){return e("div",{key:i,staticClass:"event-item pointer",on:{click:function(e){return t.viewEventDetail(a)}}},[e("div",{staticClass:"event-item-left"},[e("div",{staticClass:"event-date font-size-13"},[e("span",[t._v(t._s(a.alertTime.slice(0,16)))])]),e("div",{staticClass:"event-name"},[e("p",[e("span",{staticClass:"text-gray label"},[t._v("监控区域：")]),e("span",{staticClass:"value"},[t._v(t._s(a.cameraPosition))])]),e("p",[e("span",{staticClass:"text-gray label"},[t._v("预警类型：")]),e("span",{staticClass:"value"},[t._v(t._s(a.alertType))])])])]),e("div",{staticClass:"event-item-right"},[e("div",{staticClass:"event-image"},[e("img",{attrs:{src:a.capturedImage,alt:""}})])])])})),0)],1)])])])],1)},s=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"title"},[e("i",{staticClass:"el-icon-bell"}),e("span",[t._v("预警事件")])])}],n=(e("14d9"),e("b562")),r=e("b775"),l=e("247b"),o={components:{livePlayer:l["a"]},props:{},data(){return{loading:!1,locationList:[],location:[],streamId:null,streamUrl:"",params:{pageNum:1,pageSize:10,searchText:"",alertTypes:[],cameraPosition:[],startTime:"",endTime:""},totalCount:0,alarmList:[],loadingMore:!1,finished:!1,error:!1}},created(){this.initLoading()},mounted(){this.isMobileDevice()?-1==window.location.pathname.indexOf("app")&&this.$router.replace("/app/index"):window.location.pathname.indexOf("app")>-1&&this.$router.replace("/billboards")},watch:{},computed:{},methods:{initLoading(){var t=[Object(n["a"])(),Object(n["c"])(this.params)];this.loading=!0,Promise.all(t).then(t=>{if(200==t[0].code&&t[0].data.length>0){t[0].data.forEach(t=>{var a={label:t.groupName,value:t.groupName},e=[];t.cameras.forEach(t=>{var a={label:t.cameraLocation,value:t.zlmId,streamUrl:t.zlmUrl};void 0!=t.cameraStatus&&(a.status=t.cameraStatus),void 0!=t.videoScale&&(a.videoScale=t.videoScale),e.push(a)}),a.children=e,this.locationList.push(a)});for(let t=0;t<this.locationList.length;t++){const a=this.locationList[t].children;if(a.length>0)for(let e=0;e<a.length;e++)if(1==a[e].status){this.location=[this.locationList[t].value,a[e].value],this.streamId=a[e].value,this.streamUrl=a[e].streamUrl;break}if(this.location.length>0)break}}200==t[1].code&&t[1].data.length>0&&(this.totalCount=t[1].count,this.alarmList=t[1].data,this.alarmList.forEach(t=>{t.capturedImage=r["a"].split("/api")[0]+t.capturedImage,t.capturedVideo=r["a"].split("/api")[0]+t.capturedVideo}),this.params.pageNum++)}).finally(()=>{this.loading=!1})},handleLocationChange(t){for(let a=0;a<this.locationList.length;a++){const e=this.locationList[a].children;if(e.length>0)for(let a=0;a<e.length;a++)if(e[a].value==t[1]){this.streamId=e[a].value,this.streamUrl=e[a].streamUrl;break}}},onLoad(){this.finished||Object(n["c"])(this.params).then(t=>{if(200==t.code){var a=t.data;a.forEach(t=>{t.capturedImage=r["a"].split("/api")[0]+t.capturedImage,t.capturedVideo=r["a"].split("/api")[0]+t.capturedVideo}),this.params.pageNum++,this.alarmList=this.alarmList.concat(a),this.alarmList.length>=this.totalCount&&(this.finished=!0)}}).finally(()=>{this.loadingMore=!1}).catch(()=>{this.error=!0})},viewEventDetail(t){this.$router.push({path:"/app/event",query:{id:t.alertId}})},isMobileDevice(){return!!/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(navigator.userAgent)}}},c=o,d=(e("3808"),e("2877")),h=Object(d["a"])(c,i,s,!1,null,"bdc0c2d0",null);a["default"]=h.exports}}]);