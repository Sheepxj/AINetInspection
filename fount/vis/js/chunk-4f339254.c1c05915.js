(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f339254"],{"383a":function(e,i,t){"use strict";t("52fa")},"52fa":function(e,i,t){},"80bb":function(e,i,t){"use strict";t.r(i);var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"container"},[t("div",{staticClass:"main-wrapper flex-between"},[t("div",{staticClass:"menu-list"},[t("div",{staticClass:"menu-header flex-between"},[t("div",{staticClass:"header-left"},[e._v("设备列表")]),t("div",{staticClass:"header-right"},[t("el-button",{attrs:{type:"text"},on:{click:e.createDeviceGroup}},[t("i",{staticClass:"el-icon-plus icon-left"}),e._v("添加分组")])],1)]),t("div",{staticClass:"menu-body"},[t("el-input",{attrs:{placeholder:"输入分组或点位进行过滤",size:"small"},model:{value:e.filterText,callback:function(i){e.filterText=i},expression:"filterText"}}),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingMenu,expression:"loadingMenu"}],staticClass:"menu-wrap"},[t("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps,"node-key":"id","expand-on-click-node":!1,"filter-node-method":e.filterNode,"highlight-current":!0,"empty-text":""},on:{"node-click":e.nodeClick},scopedSlots:e._u([{key:"default",fn:function(i){var a=i.node,s=i.data;return t("span",{staticClass:"custom-tree-node father"},[t("span",{staticClass:"node-label"},[s.children?t("i",{staticClass:"iconfont icon-list font-size-14"}):t("i",{staticClass:"el-icon-video-camera"}),t("span",{attrs:{title:a.label}},[e._v(e._s(a.label))]),t("span",{staticClass:"dot",class:{normal:1==s.cameraStatus,abnormal:0==s.cameraStatus}})]),t("span",{staticClass:"child",on:{click:function(e){e.stopPropagation()}}},[t("el-dropdown",{attrs:{trigger:"click",size:"small"},on:{command:e.clickMore}},[t("span",{staticClass:"el-dropdown-link"},[t("el-button",{attrs:{icon:"el-icon-more",type:"text",size:"small"}})],1),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s.children?t("el-dropdown-item",{attrs:{icon:"el-icon-edit-outline",command:e.beforeClickMore("updateGroup",s,a)}},[e._v(" 编辑分组 ")]):e._e(),s.children?t("el-dropdown-item",{attrs:{icon:"el-icon-delete",command:e.beforeClickMore("deleteGroup",s,a)}},[e._v(" 删除分组 ")]):e._e(),s.children?t("el-dropdown-item",{attrs:{icon:"el-icon-plus",command:e.beforeClickMore("createDevice",s,a)}},[e._v(" 添加设备 ")]):e._e(),s.children?e._e():t("el-dropdown-item",{attrs:{icon:"el-icon-edit-outline",command:e.beforeClickMore("updateDevice",s,a)}},[e._v(" 编辑设备 ")]),s.children?e._e():t("el-dropdown-item",{attrs:{icon:"el-icon-delete",command:e.beforeClickMore("deleteDevice",s,a)}},[e._v(" 删除设备 ")])],1)],1)],1)])}}])}),0==e.treeData.length?t("el-empty",{attrs:{description:"暂无数据"}}):e._e()],1)],1)]),t("div",{staticClass:"main-content"},[t("div",{staticClass:"top-action flex-between"},[t("div",{staticClass:"left-action"},[t("div",{staticClass:"split-screen"},[e._v(" 分屏： "),t("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.screenNumber)),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"16分屏"}},[e._v("16分屏")]),t("el-dropdown-item",{attrs:{command:"9分屏"}},[e._v("9分屏")]),t("el-dropdown-item",{attrs:{command:"4分屏"}},[e._v("4分屏")])],1)],1)],1)]),t("div",{staticClass:"right-action"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.createDevice}},[e._v("添加设备")])],1)]),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingTable,expression:"loadingTable"}]},[t("div",{staticClass:"device-list"},[e._l(e.renderDeviceList,(function(i,a){return t("div",{key:a,staticClass:" device-item",class:{"col-4":"16分屏"==e.screenNumber,"col-3":"9分屏"==e.screenNumber,"col-2":"4分屏"==e.screenNumber}},[t("div",{staticClass:"device-wrap",class:{active:e.activeDeviceId==i.cameraId}},[t("div",{staticClass:"device-video"},[t("div",{staticClass:"device-info flex-between"},[t("div",{staticClass:"left-box"},[t("i",{staticClass:"el-icon-video-camera icon-left"}),t("span",{staticClass:"device-location"},[e._v(e._s(i.cameraLocation))]),t("span",{staticClass:"dot",class:{normal:1==i.cameraStatus,abnormal:0==i.cameraStatus}})]),t("div",{staticClass:"right-box"},[t("span",{staticClass:"device-group"},[e._v(e._s(i.groupName))])])]),t("div",{directives:[{name:"show",rawName:"v-show",value:1==i.cameraStatus&&i.zlmId&&i.zlmUrl,expression:"item.cameraStatus == 1 && item.zlmId && item.zlmUrl"}],staticClass:"video"},[t("live-player",{ref:"camera-live",refInFor:!0,attrs:{containerId:"video-live-"+i.id,streamId:i.zlmId,streamUrl:i.zlmUrl},on:{pauseStream:e.pauseStream}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1!=i.cameraStatus||!i.zlmId||!i.zlmUrl,expression:"item.cameraStatus != 1 || !item.zlmId || !item.zlmUrl"}],staticClass:"screen-abnormal"},[t("el-empty",{attrs:{description:0==i.cameraStatus?"监控设备失效，画面无法显示":"暂无监控画面"}})],1)])])])})),("16分屏"==e.screenNumber?e.totalCount<16:"9分屏"==e.screenNumber?e.totalCount<9:e.totalCount<4)?t("div",{staticClass:"device-create",class:{"col-4":"16分屏"==e.screenNumber,"col-3":"9分屏"==e.screenNumber,"col-2":"4分屏"==e.screenNumber}},[t("div",{staticClass:"device-create-wrap"},[t("div",{staticClass:"create-icon"},[t("i",{staticClass:"el-icon-plus",attrs:{title:"添加监控设备"},on:{click:e.createDevice}})])])]):e._e()],2),e.renderDeviceList.length>0?t("el-pagination",{attrs:{"current-page":e.params.pageNum,"page-sizes":[10,20,30,40,50],"page-size":e.params.pageSize,layout:"total, prev, pager, next",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e()],1)])]),t("el-dialog",{attrs:{title:e.groupTitle,visible:e.groupDialogVisible,width:"35%","close-on-click-modal":!1},on:{"update:visible":function(i){e.groupDialogVisible=i}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticClass:"dialog-wrap"},[t("div",{staticClass:"groupForm"},[t("el-form",{ref:"groupForm",staticClass:"demo-ruleForm",attrs:{model:e.groupForm,"label-position":"left","label-width":"100px"}},[t("div",{staticClass:"form-group"},[t("el-form-item",{attrs:{label:"分组名称",prop:"groupName",rules:[{required:!0,message:"分组名称不能为空",trigger:"blur"}]}},[t("el-input",{attrs:{size:"small",placeholder:"请输入分组名称",maxlength:"10","show-word-limit":""},model:{value:e.groupForm.groupName,callback:function(i){e.$set(e.groupForm,"groupName",i)},expression:"groupForm.groupName"}})],1)],1)])],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(i){e.groupDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"small",disabled:e.dialogLoading},on:{click:e.submitCreateGroup}},[e._v("确 定")])],1)]),t("el-dialog",{staticClass:"form-dialog",attrs:{title:e.deviceTitle,visible:e.deviceDialogVisible,width:"75%","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.handleCloseDialog},on:{"update:visible":function(i){e.deviceDialogVisible=i}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticClass:"dialog-wrap"},[t("div",{staticClass:"left-box"},[t("el-form",{ref:"deviceForm",staticClass:"demo-ruleForm",attrs:{model:e.deviceForm,rules:e.rules,"label-position":"left","label-width":"120px"}},[t("div",{staticClass:"form-group"},[t("el-form-item",{attrs:{label:"摄像头点位",prop:"location"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入摄像头点位，例：北区加油站",maxlength:"15","show-word-limit":""},model:{value:e.deviceForm.location,callback:function(i){e.$set(e.deviceForm,"location",i)},expression:"deviceForm.location"}})],1)],1),t("div",{staticClass:"form-group"},[t("el-form-item",{attrs:{label:"摄像头分组",prop:"group"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"请选择摄像头分组"},model:{value:e.deviceForm.group,callback:function(i){e.$set(e.deviceForm,"group",i)},expression:"deviceForm.group"}},e._l(e.cameraGroupList,(function(e,i){return t("el-option",{key:i,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"form-group"},[t("el-form-item",{attrs:{label:"视频流地址",prop:"videoStreaming"}},[t("el-input",{attrs:{type:"textarea",rows:"8",placeholder:"请输入视频流地址",resize:"none"},model:{value:e.deviceForm.videoStreaming,callback:function(i){e.$set(e.deviceForm,"videoStreaming",i)},expression:"deviceForm.videoStreaming"}})],1),t("div",{staticClass:"video-streaming-prompt"},[e._v("例：rtsp://用户名:密码@ip地址:端口号/路径")])],1)])],1),t("div",{staticClass:"right-box"},[t("div",{staticClass:"title"},[e._v("摄像头监控画面")]),t("div",{staticClass:"camera-wrap"},[t("live-player",{ref:"livePlayer",attrs:{containerId:"test-video-live",streamUrl:e.testStreamUrl}})],1)])]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"success",plain:"",size:"small",disabled:e.dialogLoading},on:{click:e.testConnect}},[e._v("测试连接")]),t("el-button",{attrs:{type:"primary",size:"small",disabled:e.dialogLoading},on:{click:e.submitCreateDevice}},[e._v("提 交")])],1)])],1)},s=[],r=(t("14d9"),t("1bfd")),o=t("b775"),l=t("247b"),c={components:{livePlayer:l["a"]},props:{},data(){return{filterText:"",treeData:[],defaultProps:{children:"children",label:"label"},totalCount:0,params:{gId:"",pageNum:1,pageSize:9},screenNumber:"9分屏",deviceList:[],renderDeviceList:[],activeDeviceId:null,loadingMenu:!1,loadingTable:!1,dialogLoading:!1,groupTitle:"添加设备分组",groupDialogVisible:!1,groupForm:{groupName:""},checkedGroupId:null,deviceTitle:"添加监控设备",deviceDialogVisible:!1,deviceForm:{location:"",group:"",videoStreaming:""},rules:{location:[{required:!0,message:"摄像头点位不能为空",trigger:"blur"}],group:[{required:!0,message:"摄像头分组不能为空",trigger:"change"}],videoStreaming:[{required:!0,message:"视频流地址不能为空",trigger:"blur"}]},cameraGroupList:[],protocolList:[{label:"RTSP",value:"RTSP"},{label:"RTMP",value:"RTMP"},{label:"ONVIF",value:"ONVIF"},{label:"GB28181",value:"GB28181"},{label:"HTTP/HTTPS ",value:"HTTP/HTTPS "}],testStreamUrl:""}},created(){this.getVideoDevice()},mounted(){},beforeDestroy(){},watch:{filterText(e){this.$refs.tree.filter(e)}},computed:{},methods:{filterNode(e,i){return!e||-1!==i.label.indexOf(e)},beforeClickMore(e,i,t){return{type:e,data:i,node:t}},clickMore(e){switch(e.type){case"updateGroup":this.confirmEditGroup(e.data);break;case"deleteGroup":this.confirmDeleteGroup(e.data);break;case"createDevice":this.createDevice(e.data);break;case"updateDevice":this.confirmEditDevice(e.data);break;case"deleteDevice":this.confirmDeleteDevice(e.data);break}},nodeClick(e,i){e.children?(this.activeDeviceId="",this.params.gId=e.id,this.params.pageNum=1,this.getVideoList()):(this.activeDeviceId=e.cameraId,this.params.gId!==e.gId?(this.params.gId=e.gId,this.params.pageNum=1,this.getVideoList(e.id)):(this.totalCount=1,this.renderDeviceList=this.deviceList.filter(i=>i.id==e.id)))},handleCommand(e){"16分屏"==e?(this.params.pageNum=1,this.params.pageSize=16):"9分屏"==e?(this.params.pageNum=1,this.params.pageSize=9):"4分屏"==e&&(this.params.pageNum=1,this.params.pageSize=4),this.screenNumber=e,this.renderDeviceList=this.deviceList.slice((this.params.pageNum-1)*this.params.pageSize,this.params.pageNum*this.params.pageSize),this.$nextTick(()=>{this.autoFitScreenRatio()})},autoFitScreenRatio(){var e=document.querySelectorAll(".device-video");if(e.length>0)for(let t=0;t<e.length;t++)e[t].style.height=JSON.stringify(e[t].offsetWidth/4*3)+"px";var i=document.querySelector(".device-create-wrap");i&&(i.style.height=JSON.stringify(i.offsetWidth/4*3)+"px")},getVideoDevice(){this.loadingMenu=!0,this.treeData=[],Object(r["g"])().then(e=>{if(200==e.code){var i=e.data;i.length>0&&(i.forEach(e=>{var i={};i.id=e.id,i.label=e.groupName,i.groupId=e.groupId;var t=[];void 0!=e.cameras&&e.cameras.forEach(i=>{t.push({id:i.id,label:i.cameraLocation,cameraId:i.cameraId,videoStreaming:i.videoStreaming,cameraStatus:i.cameraStatus,gId:e.id})}),i.children=t,this.treeData.push(i)}),this.getVideoList())}this.$nextTick(()=>{this.autoFitScreenRatio()})}).finally(()=>{this.loadingMenu=!1})},getVideoList(e){this.loadingTable=!0,this.deviceList=[],Object(r["i"])({gId:this.params.gId}).then(i=>{200==i.code&&(this.totalCount=i.count,this.deviceList=i.data,this.deviceList.forEach(e=>{e.cameraImg&&(e.cameraImg=o["a"].split("/api")[0]+e.cameraImg)}),e?(this.totalCount=1,this.renderDeviceList=this.deviceList.filter(i=>i.id==e)):this.renderDeviceList=this.deviceList.slice((this.params.pageNum-1)*this.params.pageSize,this.params.pageNum*this.params.pageSize),this.$nextTick(()=>{this.autoFitScreenRatio()}))}).finally(()=>{this.loadingTable=!1})},pauseStream(e){var i=this.$refs["camera-live"];for(let t=0;t<i.length;t++)i[t].pausePlayer(e)},createDeviceGroup(){this.groupForm={groupName:""},void 0!==this.$refs.groupForm&&this.$refs.groupForm.resetFields(),this.groupTitle="添加设备分组",this.groupDialogVisible=!0},confirmEditGroup(e){this.groupForm={groupName:""},void 0!==this.$refs.groupForm&&this.$refs.groupForm.resetFields(),this.checkedGroupId=e.groupId,this.groupTitle="编辑设备分组",this.groupForm.groupName=e.label,this.groupDialogVisible=!0},submitCreateGroup(){this.$refs["groupForm"].validate(e=>{if(e)if(this.dialogLoading=!0,"添加设备分组"==this.groupTitle)Object(r["b"])(this.groupForm).then(e=>{200==e.code&&(this.$message({message:"添加成功",type:"success"}),this.groupDialogVisible=!1,this.getVideoDevice())}).finally(()=>{this.dialogLoading=!1});else{var i={groupId:this.checkedGroupId,groupName:this.groupForm.groupName};Object(r["l"])(i).then(e=>{200==e.code&&(this.$message({message:"修改成功",type:"success"}),this.groupDialogVisible=!1,this.getVideoDevice())}).finally(()=>{this.dialogLoading=!1})}})},confirmDeleteGroup(e){this.$confirm("确定要删除该分组吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{this.loadingMenu=!0,Object(r["d"])({groupId:e.groupId}).then(e=>{200==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getVideoDevice())}).catch(()=>{this.loadingMenu=!1})})},async createDevice(){this.deviceForm={location:"",group:"",videoStreaming:""},void 0!==this.$refs.deviceForm&&this.$refs.deviceForm.resetFields(),this.deviceTitle="添加监控设备",this.loadingTable=!0,this.cameraGroupList=[];var e=[Object(r["f"])()];Promise.all(e).then(e=>{this.deviceDialogVisible=!0,this.$nextTick(()=>{var e=document.querySelector(".form-dialog .dialog-wrap");e.scrollTo({top:0})}),200==e[0].code&&e[0].data.length>0&&e[0].data.forEach(e=>{this.cameraGroupList.push({label:e.groupName,value:e.id})})}).finally(()=>{this.loadingTable=!1})},confirmEditDevice(e){this.deviceForm={location:"",group:"",videoStreaming:""},void 0!==this.$refs.deviceForm&&this.$refs.deviceForm.resetFields(),this.checkedDeviceId=e.cameraId,this.deviceTitle="编辑监控设备",this.loadingTable=!0,this.cameraGroupList=[];var i=[Object(r["f"])(),Object(r["h"])({cameraId:e.cameraId})];Promise.all(i).then(e=>{this.deviceDialogVisible=!0,this.$nextTick(()=>{var e=document.querySelector(".form-dialog .dialog-wrap");e.scrollTo({top:0})}),200==e[0].code&&e[0].data.length>0&&e[0].data.forEach(e=>{this.cameraGroupList.push({label:e.groupName,value:e.id})}),200==e[1].code&&Object.keys(e[1].data).length>0&&(this.deviceForm.location=e[1].data.cameraLocation,this.cameraGroupList.forEach(i=>{e[1].data.groupName==i.label&&(this.deviceForm.group=i.value)}),this.deviceForm.videoStreaming=e[1].data.videoStreaming)}).finally(()=>{this.loadingTable=!1})},testConnect(){this.$refs["deviceForm"].validate(e=>{e&&(this.dialogLoading=!0,Object(r["j"])({videostream:this.deviceForm.videoStreaming}).then(e=>{200==e.code&&(this.testStreamUrl=e.data)}).finally(()=>{this.dialogLoading=!1}))})},submitCreateDevice(){this.$refs["deviceForm"].validate(e=>{if(e){this.dialogLoading=!0;var i={cameraLocation:this.deviceForm.location,cameraGroup:this.deviceForm.group,typeInput:1,videoStreaming:this.deviceForm.videoStreaming};"添加监控设备"==this.deviceTitle?Object(r["a"])(i).then(e=>{200==e.code&&(this.$message({message:"添加成功",type:"success"}),this.getVideoDevice(),this.deviceDialogVisible=!1,this.testStreamUrl="",this.$refs.livePlayer.destroyPlayer())}).finally(()=>{this.dialogLoading=!1}):(i.cameraId=this.checkedDeviceId,Object(r["k"])(i).then(e=>{200==e.code&&(this.$message({message:"修改成功",type:"success"}),this.getVideoDevice(),this.deviceDialogVisible=!1,this.testStreamUrl="",this.$refs.livePlayer.destroyPlayer())}).finally(()=>{this.dialogLoading=!1}))}})},handleCloseDialog(){this.deviceDialogVisible=!1,this.testStreamUrl="",this.$refs.livePlayer.destroyPlayer()},confirmDeleteDevice(e){this.$confirm("确定要删除该设备吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{this.loadingTable=!0,Object(r["c"])({cameraId:e.cameraId}).then(e=>{200==e.code&&(this.$message({type:"success",message:"删除成功!"}),1==this.deviceList.length&&this.params.pageNum>1&&this.params.pageNum--,this.getVideoDevice())}).finally(()=>{this.loadingTable=!1})})},handleSizeChange(e){this.params.pageNum=1,this.params.pageSize=e,this.getVideoList()},handleCurrentChange(e){this.params.pageNum=e,this.renderDeviceList=this.deviceList.slice((this.params.pageNum-1)*this.params.pageSize,this.params.pageNum*this.params.pageSize)}}},d=c,n=(t("383a"),t("2877")),m=Object(n["a"])(d,a,s,!1,null,"d6f01402",null);i["default"]=m.exports}}]);