(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-effc0186"],{a85e:function(t,a,s){"use strict";s.r(a);var i=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"container"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main-wrapper"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{staticClass:"billboards-left",attrs:{span:16}},[s("el-row",{staticClass:"billboards-left-top",attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"card stats-digit"},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"stats-label"},[t._v("摄像头布控")]),s("div",{staticClass:"stats-value"},[t._v(t._s(t.statistics.deviceCount))])]),s("div",{staticClass:"card-icon text-primary"},[s("i",{staticClass:"iconfont icon-bukong"})])]),s("div",{staticClass:"card stats-trend border-top"},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"stats-value-ratio badge",class:{"badge-yellow":0==t.statistics.deviceCount,"badge-red":t.statistics.deviceCount>0&&t.statistics.deviceCount!=t.statistics.deviceWorkCount,"badge-green":t.statistics.deviceCount>0&&t.statistics.deviceCount==t.statistics.deviceWorkCount}},[s("i",{staticClass:"iconfont icon-yuandian"}),s("span",[t._v(t._s(t.statistics.deviceCount>0?t.statistics.deviceRatio+"%":"N/A"))])]),s("div",{staticClass:"stats-value-desc text-gray"},[t._v(" "+t._s(t.statistics.deviceCount>0?100==t.statistics.deviceRatio?"设备状态全部正常":t.statistics.deviceCount-t.statistics.deviceWorkCount+"台设备状态异常":"当前无设备")+" ")])])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"card stats-digit"},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"stats-label"},[t._v("今日预警数量")]),s("div",{staticClass:"stats-value"},[t._v(t._s(t.statistics.todayCount))])]),s("div",{staticClass:"card-icon text-primary"},[s("i",{staticClass:"iconfont icon-gaojingshijian"})])]),s("div",{staticClass:"card stats-trend border-top"},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"stats-value-ratio badge",class:{"badge-yellow":0==t.statistics.todayStatus,"badge-red":1==t.statistics.todayStatus,"badge-green":2==t.statistics.todayStatus}},[s("i",{class:{"el-icon-caret-bottom":t.statistics.deviceCount>0&&0==t.statistics.todayStatus,"el-icon-caret-top":t.statistics.deviceCount>0&&1==t.statistics.todayStatus,"iconfont icon-yuandian":0==t.statistics.deviceCount||2==t.statistics.todayStatus}}),s("span",[t._v(t._s(t.statistics.todayCount>0?t.statistics.todayRatio+"%":"N/A"))])]),s("div",{staticClass:"stats-value-desc text-gray"},[t._v(t._s(t.statistics.todayCount>0?0==t.statistics.todayStatus?"比昨天预警数量降低":1==t.statistics.todayStatus?"比昨天预警数量升高":"与昨天预警数量相同":"当前无预警信息"))])])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"card stats-digit"},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"stats-label"},[t._v("昨日预警数量")]),s("div",{staticClass:"stats-value"},[t._v(t._s(t.statistics.yesterdayCount))])]),s("div",{staticClass:"card-icon text-primary"},[s("i",{staticClass:"iconfont icon-alarm"})])]),s("div",{staticClass:"card stats-trend border-top"},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"stats-value-ratio badge",class:{"badge-yellow":0==t.statistics.yesterdayStatus,"badge-red":1==t.statistics.yesterdayStatus,"badge-green":2==t.statistics.yesterdayStatus}},[s("i",{class:{"el-icon-caret-bottom":t.statistics.deviceCount>0&&0==t.statistics.yesterdayStatus,"el-icon-caret-top":t.statistics.deviceCount>0&&1==t.statistics.yesterdayStatus,"iconfont icon-yuandian":0==t.statistics.deviceCount||2==t.statistics.yesterdayStatus}}),s("span",[t._v(t._s(t.statistics.yesterdayCount>0?t.statistics.yesterdayRatio+"%":"N/A"))])]),s("div",{staticClass:"stats-value-desc text-gray"},[t._v(t._s(t.statistics.yesterdayCount>0?0==t.statistics.yesterdayStatus?"比前天预警数量降低":1==t.statistics.yesterdayStatus?"比前天预警数量升高":"与前天预警数量相同":"无预警信息"))])])])])],1),s("el-row",{staticStyle:{"margin-top":"24px"},attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"layout card"},[s("div",{staticClass:"layout-top flex-between"},[s("div",{staticClass:"title"},[s("i",{staticClass:"el-icon-data-line",staticStyle:{"vertical-align":"text-bottom"}}),t._v("预警排名走势分析")]),s("div",{staticClass:"action"},[s("div",{staticClass:"filter-btn-group"},[s("el-button-group",[s("el-button",{staticClass:"chart-filter",class:{active:1==t.activeIndex},attrs:{size:"small"},on:{click:function(a){return t.filterWarningRank(1)}}},[t._v("今天")]),s("el-button",{staticClass:"chart-filter",class:{active:2==t.activeIndex},attrs:{size:"small"},on:{click:function(a){return t.filterWarningRank(2)}}},[t._v("7天")]),s("el-button",{staticClass:"chart-filter",class:{active:3==t.activeIndex},attrs:{size:"small"},on:{click:function(a){return t.filterWarningRank(3)}}},[t._v("30天")])],1)],1)])]),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.chartLoading,expression:"chartLoading"}],staticClass:"layout-content"},[t.splineAreaChart.series.length>0?s("div",{staticClass:"line-chart"},[s("apexchart",{staticClass:"apex-charts",attrs:{height:t.lineChartHeight,type:"area",dir:"ltr",series:t.splineAreaChart.series,options:t.splineAreaChart.chartOptions}})],1):s("div",{staticClass:"chart-empty"},[s("el-empty",{attrs:{description:"暂无预警排名走势信息"}})],1)])])])],1)],1),s("el-col",{staticClass:"billboards-right",attrs:{span:8}},[s("el-row",{staticClass:"realtime-monitor",attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"layout card"},[s("div",{staticClass:"layout-top flex-between"},[s("div",{staticClass:"title"},[s("i",{staticClass:"el-icon-video-camera",staticStyle:{"vertical-align":"text-bottom"}}),t._v("摄像头实时监控画面")]),s("div",{staticClass:"action"},[t.locationList.length>0?s("div",{staticClass:"device-options"},[s("el-cascader",{attrs:{options:t.locationList,size:"small"},on:{change:t.handleLocationChange},model:{value:t.location,callback:function(a){t.location=a},expression:"location"}})],1):t._e(),0==t.locationList.length?s("div",{staticClass:"create-button"},[s("el-button",{attrs:{type:"text"},on:{click:t.createDevice}},[t._v("添加摄像头")])],1):t._e()])]),s("div",{staticClass:"layout-content"},[t.locationList.length>0&&!t.deviceAbnormal?s("div",{staticClass:"realtime-video"},[s("live-player",{attrs:{containerId:"video-live",streamId:t.streamId,streamUrl:t.streamUrl}})],1):s("div",{staticClass:"footage-empty"},[s("el-empty",{attrs:{description:0==t.locationList.length?"点击 添加摄像头 添加监控设备":t.deviceAbnormal?"监控设备失效，画面无法显示":"暂无监控画面"}})],1)])])])],1),s("el-row",{staticStyle:{"margin-top":"24px"},attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"layout card"},[s("div",{staticClass:"layout-top flex-between"},[s("div",{staticClass:"title"},[s("i",{staticClass:"el-icon-bell",staticStyle:{"vertical-align":"middle"}}),t._v("最近预警列表清单")]),s("div",{staticClass:"action"},[t.alarmList.length>0?s("div",{staticClass:"tomore-button"},[s("el-button",{attrs:{type:"text"},on:{click:t.toMoreWarning}},[t._v("更多")])],1):t._e(),0==t.locationList.length?s("div",{staticClass:"create-button"},[s("el-button",{attrs:{type:"text"},on:{click:t.createTask}},[t._v("添加监测任务")])],1):t._e()])]),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.alarmLoading,expression:"alarmLoading"}],staticClass:"layout-content"},[s("div",{staticClass:"simple-list"},[t.alarmList.length>0?s("div",{staticClass:"simple-wrap"},[s("vue-seamless-scroll",{ref:"scrollBar",attrs:{data:t.alarmList,loop:!0,"class-option":t.classOption}},[s("ul",{staticClass:"list-unstyled",class:{"activity-wid":t.alarmList.length>1}},t._l(t.alarmList,(function(a,i){return s("li",{key:i,staticClass:"activity-list"},[s("div",{staticClass:"activity-icon avatar-xs"},[s("span",{staticClass:"avatar-title bg-primary text-primary rounded-circle"},[s("i",{staticClass:"iconfont icon-laba"})])]),s("div",{staticClass:"event-list"},[s("div",{staticClass:"event-list-item pointer",on:{click:function(s){return t.viewDetail(a)}}},[s("div",{staticClass:"event-list-item-left"},[s("div",{staticClass:"event-date font-size-13"},[s("span",[t._v(t._s(a.alertTime.slice(0,16)))])]),s("div",{staticClass:"event-name"},[s("p",[s("span",{staticClass:"text-gray label"},[t._v("监控区域：")]),s("span",{staticClass:"value"},[t._v(t._s(a.cameraPosition))])]),s("p",[s("span",{staticClass:"text-gray label"},[t._v("预警类型：")]),s("span",{staticClass:"value"},[t._v(t._s(a.alertType))])])])]),s("div",{staticClass:"event-list-item-right"},[s("div",{staticClass:"event-image"},[s("img",{attrs:{src:a.capturedImage,alt:""}})])])])])])})),0)])],1):s("div",{staticClass:"alarm-empty"},[s("el-empty",{attrs:{description:"暂无预警信息"}})],1)])])])])],1)],1)],1)],1),s("el-dialog",{attrs:{title:"告警详情",visible:t.dialogVisible,width:"65%"},on:{"update:visible":function(a){t.dialogVisible=a}}},[s("div",{staticClass:"dialog-wrap"},[s("div",{staticClass:"detail"},[s("div",{staticClass:"left-box"},[s("div",{staticClass:"result-item"},[s("span",{staticClass:"result-item-key"},[t._v("预警编号：")]),s("span",{staticClass:"result-item-value"},[t._v(t._s(t.alarmInfo.alertId))])]),s("div",{staticClass:"result-item"},[s("span",{staticClass:"result-item-key"},[t._v("摄像头点位：")]),s("span",{staticClass:"result-item-value"},[t._v(t._s(t.alarmInfo.cameraPosition))])]),s("div",{staticClass:"result-item"},[s("span",{staticClass:"result-item-key"},[t._v("监测任务：")]),s("span",{staticClass:"result-item-value"},[t._v(t._s(t.alarmInfo.monitoringTask))])]),s("div",{staticClass:"result-item"},[s("span",{staticClass:"result-item-key"},[t._v("预警类型：")]),s("span",{staticClass:"result-item-value"},[t._v(t._s(t.alarmInfo.alertType))])]),s("div",{staticClass:"result-item"},[s("span",{staticClass:"result-item-key"},[t._v("预警时间：")]),s("span",{staticClass:"result-item-value"},[t._v(t._s(t.alarmInfo.alertTime))])]),s("div",{staticClass:"result-item"},[s("span",{staticClass:"result-item-key"},[t._v("告警级别：")]),s("span",{staticClass:"result-item-value"},[t._v(t._s(t.alarmInfo.alertLevel))])])]),s("div",{staticClass:"right-box"},[s("div",{staticClass:"title"},[t._v("摄像头监控截取视频片段")]),s("div",{staticClass:"camera-wrap"},[s("video",{attrs:{src:t.alarmInfo.capturedVideo,poster:t.alarmInfo.capturedImage,controls:"",preload:"auto",autoplay:"autoplay",loop:"loop"}})])])])])])],1)},e=[],r=(s("14d9"),s("ccea"));function l(){return Object(r["a"])({url:"/sterams/getCamerastus",method:"get"})}function c(){return Object(r["a"])({url:"/radis/returnmsg",method:"get"})}function o(){return Object(r["a"])({url:"/warningTable/getTodayTopAlertTypes",method:"get"})}function n(){return Object(r["a"])({url:"/warningTable/getSevenTopAlertTypes",method:"get"})}function d(){return Object(r["a"])({url:"/warningTable/getMonthTopAlertTypes",method:"get"})}function u(){return Object(r["a"])({url:"/boards/location",method:"get"})}function v(){return Object(r["a"])({url:"/warningTable/getwarning",method:"get"})}function h(t){return Object(r["a"])({url:"/warningTable/selectbytaskid",method:"get",params:t})}var p=s("b775"),m=s("247b"),g={components:{livePlayer:m["a"]},props:{},data(){return{loading:!1,countDuration:2e3,statistics:{deviceCount:0,deviceWorkCount:0,deviceRatio:0,todayCount:0,todayRatio:0,todayStatus:0,yesterdayCount:0,yesterdayRatio:0,yesterdayStatus:0},locationList:[],location:[],splineAreaChart:{series:[],chartOptions:{chart:{toolbar:{show:!1},animations:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},colors:["#556ee6","#34c38f","#4aa3ff"],xaxis:{categories:[]},yaxis:{labels:{formatter:function(t){return Math.floor(t)}}},grid:{borderColor:"#f1f1f1"},tooltip:{}}},activeIndex:1,dialogVisible:!1,alarmList:[],isfirst:!0,classOption:{step:.8},timer:null,deviceAbnormal:!1,alarmLoading:!1,alarmInfo:{alertId:"",alertLevel:"",alertTime:"",alertType:"",cameraPosition:"",capturedImage:"",capturedVideo:"",monitoringTask:""},chartLoading:!1,lineChartHeight:"",streamId:null,streamUrl:""}},created(){this.initLoading()},mounted(){},beforeDestroy(){clearInterval(this.timer)},watch:{},computed:{},methods:{initLoading(){this.loading=!0,this.locationList=[];var t=[u(),v(),l(),c(),o()];Promise.all(t).then(t=>{if(200==t[0].code){if(t[0].data.length>0){t[0].data.forEach(t=>{var a={label:t.groupName,value:t.groupName},s=[];t.cameras.forEach(t=>{var a={label:t.cameraLocation,value:t.zlmId,streamUrl:t.zlmUrl};void 0!=t.cameraStatus&&(a.status=t.cameraStatus),void 0!=t.videoScale&&(a.videoScale=t.videoScale),s.push(a)}),a.children=s,this.locationList.push(a)});for(let t=0;t<this.locationList.length;t++){const a=this.locationList[t].children;if(a.length>0)for(let s=0;s<a.length;s++)if(1==a[s].status){this.location=[this.locationList[t].value,a[s].value],this.streamId=a[s].value,this.streamUrl=a[s].streamUrl;break}if(this.location.length>0)break}this.$nextTick(()=>{var t=document.querySelector(".realtime-video");t&&(t.style.height=JSON.stringify(.75*t.offsetWidth)+"px")})}}else{var a=document.querySelector(".realtime-video");a&&(a.style.height=JSON.stringify(.75*a.offsetWidth)+"px")}if(200==t[1].code&&t[1].data.length>0&&(this.alarmList=t[1].data,this.alarmList.forEach(t=>{t.capturedImage=p["a"].split("/api")[0]+t.capturedImage,t.capturedVideo=p["a"].split("/api")[0]+t.capturedVideo})),this.timer=setInterval(()=>{v().then(t=>{200==t.code&&t.data.length>0&&(this.alarmList=t.data,this.alarmList.forEach(t=>{t.capturedImage=p["a"].split("/api")[0]+t.capturedImage,t.capturedVideo=p["a"].split("/api")[0]+t.capturedVideo}))})},12e4),200==t[2].code&&Object.keys(t[2].data).length>0){var s=t[2].data;this.statistics.deviceCount=s.Camerasum,this.statistics.deviceWorkCount=s.working,s.rate?this.statistics.deviceRatio=Number(s.rate.split("%")[0]):this.statistics.deviceRatio=0}if(200==t[3].code&&Object.keys(t[3].data).length>0){var i=t[3].data;this.statistics.todayCount=i.today,this.statistics.todayRatio=Math.abs(Number(i["day-yesterday"])),this.statistics.todayStatus=Number(i["day-yesterday"])>0?1:Number(i["day-yesterday"])<0?0:2,this.statistics.yesterdayCount=i.yesterday,this.statistics.yesterdayRatio=Math.abs(Number(i["yesterday-before"])),this.statistics.yesterdayStatus=Number(i["yesterday-before"])>0?1:Number(i["yesterday-before"])<0?0:2}if(200==t[4].code){var e=t[4].data;if(Object.keys(e).length>0){var r=[],l=[],c=!0;for(const t in e){var o={};o.name=t;var n=[];for(const a in e[t])c&&l.push(a),n.push(e[t][a]);c=!1,o.data=n,r.push(o)}this.splineAreaChart.series=r,this.splineAreaChart.chartOptions.xaxis.categories=l}this.$nextTick(()=>{var t=document.querySelector(".billboards-right"),a=document.querySelector(".billboards-left-top");this.lineChartHeight=JSON.stringify(t.offsetHeight-a.offsetHeight-122);var s=document.querySelector(".chart-empty");s&&(s.style.height=JSON.stringify(JSON.parse(this.lineChartHeight)+15)+"px")})}}).finally(()=>{this.loading=!1})},handleLocationChange(t){for(let a=0;a<this.locationList.length;a++){const s=this.locationList[a].children;if(s.length>0)for(let a=0;a<s.length;a++)if(s[a].value==t[1]){this.streamId=s[a].value,this.streamUrl=s[a].streamUrl;break}}},filterWarningRank(t){this.activeIndex=t,1==t?this.getTodayAlarmTrend():2==t?this.getLastWeekAlarmTrend():this.getLastMonthAlarmTrend()},getTodayAlarmTrend(){this.chartLoading=!0,o().then(t=>{setTimeout(()=>{if(this.chartLoading=!1,200==t.code){var a=t.data;if(Object.keys(a).length>0){var s=[],i=[],e=!0;for(const t in a){var r={};r.name=t;var l=[];for(const s in a[t])e&&i.push(s),l.push(a[t][s]);e=!1,r.data=l,s.push(r)}this.splineAreaChart.series=s,this.splineAreaChart.chartOptions.xaxis.categories=i}else this.splineAreaChart.series=[],this.splineAreaChart.chartOptions.xaxis.categories=[]}},500)}).catch(()=>{this.chartLoading=!1})},getLastWeekAlarmTrend(){this.chartLoading=!0,n().then(t=>{setTimeout(()=>{if(this.chartLoading=!1,200==t.code){var a=t.data;if(Object.keys(a).length>0){var s=[],i=[],e=!0;for(const t in a){var r={};r.name=t;var l=[];for(const s in a[t])e&&i.push(s),l.push(a[t][s]);e=!1,r.data=l,s.push(r)}this.splineAreaChart.series=s,this.splineAreaChart.chartOptions.xaxis.categories=i}}else this.splineAreaChart.series=[],this.splineAreaChart.chartOptions.xaxis.categories=[]},500)}).catch(()=>{this.chartLoading=!1})},getLastMonthAlarmTrend(){this.chartLoading=!0,d().then(t=>{setTimeout(()=>{if(this.chartLoading=!1,200==t.code){var a=t.data;if(Object.keys(a).length>0){var s=[],i=[],e=!0;for(const t in a){var r={};r.name=t;var l=[];for(const s in a[t])e&&i.push(s),l.push(a[t][s]);e=!1,r.data=l,s.push(r)}this.splineAreaChart.series=s,this.splineAreaChart.chartOptions.xaxis.categories=i}else this.splineAreaChart.series=[],this.splineAreaChart.chartOptions.xaxis.categories=[]}},500)}).catch(()=>{this.chartLoading=!1})},toMoreWarning(){this.$router.push("/warning")},viewDetail(t){this.alarmLoading=!0,h({alertId:t.alertId}).then(t=>{200==t.code&&(this.dialogVisible=!0,this.alarmInfo=t.data,Object.keys(this.alarmInfo).length>0&&(this.alarmInfo.capturedImage=p["a"].split("/api")[0]+this.alarmInfo.capturedImage,this.alarmInfo.capturedVideo=p["a"].split("/api")[0]+this.alarmInfo.capturedVideo))}).finally(()=>{this.alarmLoading=!1})},createDevice(){this.$router.push("/access")},createTask(){this.$router.push("/task")}}},C=g,y=(s("b382"),s("2877")),f=Object(y["a"])(C,i,e,!1,null,"18e717a2",null);a["default"]=f.exports},b20f:function(t,a,s){},b382:function(t,a,s){"use strict";s("b20f")}}]);