(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78889b22"],{"3ce7":function(t,e,a){"use strict";a.d(e,"c",(function(){return i})),a.d(e,"d",(function(){return l})),a.d(e,"f",(function(){return n})),a.d(e,"e",(function(){return r})),a.d(e,"a",(function(){return o})),a.d(e,"i",(function(){return c})),a.d(e,"h",(function(){return u})),a.d(e,"g",(function(){return d})),a.d(e,"b",(function(){return m}));var s=a("ccea");function i(){return Object(s["a"])({url:"/createdetectiontask/selectAimodels",method:"get"})}function l(){return Object(s["a"])({url:"/boards/location",method:"get"})}function n(t){return Object(s["a"])({url:"/tasks/gettasklist",method:"get",params:t})}function r(t){return Object(s["a"])({url:"/tasks/getDetectionTask",method:"get",params:t})}function o(t){return Object(s["a"])({url:"/createdetectiontask/insertDetectiontask",method:"post",data:t})}function c(t){return Object(s["a"])({url:"/createdetectiontask/updateDetectiontask",method:"post",data:t})}function u(t){return Object(s["a"])({url:"/createdetectiontask/startvideostream",method:"get",params:t})}function d(t){return Object(s["a"])({url:"/createdetectiontask/stopvideostream",method:"get",params:t})}function m(t){return Object(s["a"])({url:"/tasks/deletetask",method:"get",params:t})}},"93db":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"module"},[a("div",{staticClass:"page-top-action"},[a("div",{staticClass:"table-filter"},[a("div",{staticClass:"filter-params"},[a("div",{staticClass:"filter-control"},[a("el-input",{staticClass:"search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:"请输入搜索内容",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.filterList(e)}},model:{value:t.params.keyword,callback:function(e){t.$set(t.params,"keyword",e)},expression:"params.keyword"}})],1)]),a("div",{staticClass:"else-params"},[a("div",{staticClass:"filter-params"},[a("div",{staticClass:"filter-control"},[a("el-select",{attrs:{placeholder:"请选择告警级别",size:"small"},on:{change:t.filterList},model:{value:t.params.alertLevel,callback:function(e){t.$set(t.params,"alertLevel",e)},expression:"params.alertLevel"}},t._l(t.alarmLevelList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1)]),a("div",{staticClass:"filter-params"},[a("div",{staticClass:"filter-control"},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss",size:"small","picker-options":t.pickerOptions},on:{change:t.filterList},model:{value:t.params.dateRange,callback:function(e){t.$set(t.params,"dateRange",e)},expression:"params.dateRange"}})],1)])])]),a("div",{staticClass:"right-search"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:t.createTask}},[t._v("添加任务")])],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"","empty-text":""},scopedSlots:t._u([{key:"empty",fn:function(){return[a("el-empty",{attrs:{description:"暂无数据"}})]},proxy:!0}])},[a("el-table-column",{attrs:{prop:"taskName",label:"任务名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"text-primary pointer",on:{click:function(a){return t.viewDetail(e.row)}}},[t._v(" "+t._s(e.row.taskName)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"cameraPosition",label:"摄像头点位"}}),a("el-table-column",{attrs:{label:"算法模型"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.aiModels.join("，")))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"任务状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?a("div",{staticClass:"badge badge-purple font-size-12"},[t._v(" 未启动 ")]):1==e.row.status?a("div",{staticClass:"badge badge-green font-size-12"},[t._v(" 已启动 ")]):a("div",{staticClass:"badge badge-orange font-size-12"},[t._v(" 任务丢失 ")])]}}])}),a("el-table-column",{attrs:{prop:"alertLevel",label:"告警级别",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["高"==e.row.alertLevel?a("div",{staticClass:"badge badge-red"},[t._v("高")]):"中"==e.row.alertLevel?a("div",{staticClass:"badge badge-orange"},[t._v("中")]):a("div",{staticClass:"badge badge-purple"},[t._v("低")])]}}])}),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.createTime.slice(0,16)))])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"编辑",placement:"top"}},[a("el-button",{staticClass:"font-size-16",class:{"text-gray":1==e.row.status},attrs:{type:"text",icon:"el-icon-edit",disabled:1==e.row.status},on:{click:function(a){return t.confirmEdit(e.row)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"删除",placement:"top"}},[a("el-button",{staticClass:"font-size-16",class:{"text-gray":1==e.row.status,"text-red":0==e.row.status||2==e.row.status},attrs:{type:"text",icon:"el-icon-delete",disabled:1==e.row.status},on:{click:function(a){return t.confirmDelete(e.row)}}})],1),0==e.row.status?a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"启动",placement:"top"}},[a("el-button",{staticClass:"text-green font-size-16",attrs:{type:"text",icon:"el-icon-video-play"},on:{click:function(a){return t.confirmPlay(e.row)}}})],1):t._e(),1==e.row.status?a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"停用",placement:"top"}},[a("el-button",{staticClass:"text-orange font-size-16",attrs:{type:"text",icon:"el-icon-video-pause"},on:{click:function(a){return t.confirmPause(e.row)}}})],1):t._e()]}}])})],1),t.tableData.length>0?a("el-pagination",{attrs:{"current-page":t.params.pageNum,"page-sizes":[10,20,30,40,50],"page-size":t.params.pageSize,layout:"total, prev, pager, next",total:t.totalCount},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e()],1),a("el-dialog",{attrs:{title:"监测任务详情",visible:t.dialogVisible,width:"65%","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"dialog-wrap"},[a("div",{staticClass:"detail"},[a("div",{staticClass:"left-box"},[a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("任务名称：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.taskName))])]),t.taskInfo.taskDescription?a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("任务描述：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.taskDescription)+" ")])]):t._e(),a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("摄像头点位：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.cameraPosition))])]),a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("视频抽帧级别：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(0==t.taskInfo.frameInterval?"不抽帧":1==t.taskInfo.frameInterval?"低":2==t.taskInfo.frameInterval?"中":"高"))])]),a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("检测类型：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(1==t.taskInfo.frameSelect?"默认":2==t.taskInfo.frameSelect?"闯入检测":"离开检测"))])]),a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("算法模型：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.aiModels))])]),1!=t.taskInfo.frameSelect?a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("预警目标数量：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.targetNumber))])]):t._e(),2==t.taskInfo.frameSelect?a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("预警目标停留时长：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.setTime))])]):t._e(),3==t.taskInfo.frameSelect?a("div",{staticClass:"result-item"},[a("span",{staticClass:"result-item-key"},[t._v("预警目标离开时长：")]),a("span",{staticClass:"result-item-value"},[t._v(t._s(t.taskInfo.setTime))])]):t._e()]),a("div",{staticClass:"right-box"},[a("div",{staticClass:"title"},[t._v("摄像头监控画面")]),a("div",{staticClass:"camera-wrap"},[a("live-player",{attrs:{containerId:"video-live",streamId:t.streamId,streamUrl:t.streamUrl}})],1)])])])])],1)},i=[],l=(a("14d9"),a("3ce7")),n=(a("b775"),a("247b")),r={components:{livePlayer:n["a"]},props:{},data(){return{loading:!1,tableData:[],totalCount:0,params:{keyword:"",pageNum:1,pageSize:10,detectType:"",alertLevel:"",dateRange:[]},alarmLevelList:[{label:"全部",value:"全部"},{label:"高",value:"高"},{label:"中",value:"中"},{label:"低",value:"低"}],pickerOptions:{disabledDate(t){return t.getTime()>Date.now()-864e4},shortcuts:[{text:"过去 1 小时内",onClick(t){const e=new Date,a=new Date;a.setTime(a.getTime()-36e5),t.$emit("pick",[a,e])}},{text:"过去 24 小时内",onClick(t){const e=new Date,a=new Date;a.setTime(a.getTime()-864e5),t.$emit("pick",[a,e])}},{text:"过去 1 周内",onClick(t){const e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"过去 1 个月内",onClick(t){const e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"过去 3 个月内",onClick(t){const e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},createDialogVisible:!1,form:{detectType:""},dialogVisible:!1,taskInfo:{},drawerLoading:!1,streamId:"",streamUrl:""}},created(){this.getTaskList()},mounted(){},watch:{},computed:{},methods:{getTaskList(){this.loading=!0,this.tableData=[];var t={taskName:this.params.keyword,pageNum:this.params.pageNum,pageSize:this.params.pageSize,alertLevel:this.params.alertLevel,startTime:this.params.dateRange.length>0?this.params.dateRange[0]:"",endTime:this.params.dateRange.length>0?this.params.dateRange[1]:""};Object(l["f"])(t).then(t=>{200==t.code&&(this.tableData=t.data,this.tableData.forEach(t=>{var e=[];t.aiModels.forEach(t=>{e.push(t.modelName)}),t.aiModels=e}),this.totalCount=t.count)}).finally(()=>{this.loading=!1})},filterList(){this.params.pageNum=1,this.getTaskList()},createTask(){this.$router.push("/task/target/create")},confirmEdit(t){this.$router.push({path:"/task/target/create",query:{id:t.id,name:t.taskName}})},viewDetail(t){this.loading=!0,Object(l["e"])({Id:t.id}).then(t=>{if(200==t.code){if(this.dialogVisible=!0,this.taskInfo=t.data,this.taskInfo.aiModels.length>0){var e=[];this.taskInfo.aiModels.forEach(t=>{e.push(t.modelName)}),this.taskInfo.aiModels=e.join("，")}this.taskInfo.setTime&&(this.taskInfo.setTime<=60?this.taskInfo.setTime=this.taskInfo.setTime+"秒钟":this.taskInfo.setTime>60&&this.taskInfo.setTime<=3600?this.taskInfo.setTime=this.taskInfo.setTime/60+"分钟":this.taskInfo.setTime=this.taskInfo.setTime/3600+"小时"),this.$nextTick(async()=>{var t=document.querySelector(".dialog-wrap");t.scrollTo({top:0}),this.streamId=this.taskInfo.zlmId,this.streamUrl=this.taskInfo.zlmUrl})}}).finally(()=>{this.loading=!1})},confirmDelete(t){this.$confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{this.loading=!0,Object(l["b"])({Id:t.id}).then(t=>{200==t.code&&(this.$message({type:"success",message:"删除成功！"}),1==this.tableData.length&&this.params.pageNum>1&&this.params.pageNum--,this.getTaskList())}).catch(()=>{this.loading=!1})})},confirmPlay(t){this.$confirm("确定要启动该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{this.loading=!0,Object(l["h"])({Id:t.id}).then(t=>{200==t.code&&(this.$message({type:"success",message:"启动成功！"}),this.getTaskList())}).catch(()=>{this.loading=!1})})},confirmPause(t){this.$confirm("确定要停用该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{this.loading=!0,Object(l["g"])({Id:t.id}).then(t=>{200==t.code&&(this.$message({type:"success",message:"关闭成功！"}),this.getTaskList())}).catch(()=>{this.loading=!1})})},handleSizeChange(t){this.params.pageNum=1,this.params.pageSize=t,this.getTaskList()},handleCurrentChange(t){this.params.pageNum=t,this.getTaskList()}}},o=r,c=(a("f0b0"),a("2877")),u=Object(c["a"])(o,s,i,!1,null,"33fc2738",null);e["default"]=u.exports},cff1:function(t,e,a){},f0b0:function(t,e,a){"use strict";a("cff1")}}]);